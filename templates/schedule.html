<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>일정관리</title>

    <style>
	body{
	    font-family: Arial, sans-serif;
	    background: #f4f6f9;
	    display: flex;
	    flex-direction: column;
	    align-items: center;
	    padding-top: 40px;
	}

	#app {
	    background: white;
	    width: 420px;
	    padding: 25px;
	    border-radius: 15px;
	    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
	}

	input {
	    width: 100%;
	    padding: 10px;
	    margin: 6px 0;
	    border-radius: 8px;
	    border: 1px solid #ccc;
	    font-size: 15px;
	}

	button {
	    padding: 10px 15px;
	    margin-top: 10px;
	    background: #4a90e2;
	    color: white;
	    border: none;
	    border-radius: 8px;
	    cursor: pointer;
	    font-size: 15px;
	}

	button:hover {
	    background: #357ab8;
	}

	.schedule-item {
	    padding: 10px;
	    background: #eef3ff;
	    margin: 8px 0;
	    border-radius: 8px;
	    display: flex;
	    justify-content: space-between;
	   align-items: center;
	}

	.schedule-buttons button {
	    background: #ff6b6b;
	    margin-left: 5px;
	    padding: 7px 10px;
	    font-size: 13px;
	}
	.edit-btn {
	    background: #4caf50 !important;
	}
    </style>
</head>

<body>

<div id="app">

    	<h1>일정관리 프로그램</h1>

	<input id="title" type="text" placeholder="일정 제목">
	<input id="date" type="date">
	<input id="time" type="time">
	<input id="note" type="text" placeholder="메모">

	<button id="addBtn">추가하기</button>

    <hr>

    <h2>일정 목록</h2>
    <div id="scheduleList"></div>

</div>

    <script>
	let editingId = null;
	let lastSchedules = [];
	
	document.getElementById("addBtn").onclick = function () {

		let title = document.getElementById("title").value;
		let date = document.getElementById("date").value;
		let time = document.getElementById("time").value;
		let note = document.getElementById("note").value;

		if (editingId !== null) {
		    fetch("http://127.0.0.1:5000/update_schedule", {
		        method: "POST",
		        headers: { "Content-Type": "application/json" },
		        body: JSON.stringify({
			id: editingId,
		            title: title,
		            date: date,
		            time: time,
		            note: note
		        })
		})
		.then(res => res.json())
		.then(data => {
		    alert(data.message);
		    editingId = null;
		    loadSchedules();
		});
		return;
		}

		fetch("http://127.0.0.1:5000/add_schedule", {
		    method: "POST",
		    headers: { "Content-Type": "application/json" },
		    body: JSON.stringify({
		        title: title,
		        date: date,
		        time: time,
		        note: note,
		    })
		})
		.then(res => res.json())
		.then(data => {
		    alert(data.message);
		    loadSchedules();
		});
	    };


	
	    function loadSchedules() {
    		fetch("http://127.0.0.1:5000/get_schedule")
		.then(r => r.json())
		.then(data => {

		    let list = data.schedule;
		    lastSchedules = list;

		    let html = "";

		    list.forEach(item => {
		        html += `
			<div class="schedule-item">
			    <span>${item.date} ${item.time} - ${item.title} (${item.note})</span>

			    <div class="schedule-buttons">
			        <button onclick="deleteSchedule(${item.id})">삭제</button>
			        <button class="edit-btn" onclick="editSchedule(${item.id})">수정</button>
			    </div>
			</div>
		        `;
		    });

		    document.getElementById("scheduleList").innerHTML = html;
		});
	}
	function deleteSchedule(id) {
	    fetch("http://127.0.0.1:5000/delete_schedule", {
	        method: "POST",
	        headers: { "Content-Type": "application/json" },
	        body: JSON.stringify({ id: id })
	    })
	    .then(r => r.json())
	    .then(data => {
	        alert(data.message);
	        loadSchedules();
	    });
	}

	function editSchedule(id) {
	    let item = lastSchedules.find(x => x.id === id);

	    document.getElementById("title").value = item.title;
	    document.getElementById("date").value = item.date;
	    document.getElementById("time").value = item.time;
	    document.getElementById("note").value = item.note;

	    editingId = id;
	}

	loadSchedules();
</script>

</body>
</html>